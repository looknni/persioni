#!/bin/sh
function dr(){
        awk '{if($2>0) print}'|grep "$1"
}
mangle="mangle"
filter="filter"
nat="nat"
d='DROP'
dn='DNAT'
function ipt(){
        iptables -t $1 -nvL --line-numbers
}
function ipt6(){
        ip6tables -t $1 -nvL --line-numbers
}
function sipt(){
        iptables-nft -t $1 -S
}
function sipt6(){
        ip6tables-nft -t $1 -S
}
# ipt6 $filter | dr $d
ipt $filter | dr $d
echo "### MANGLE ###"
# ipt6 $mangle | dr $d
ipt $mangle | dr $d
ipt $nat | dr $dn
logread | grep -Eo '([0-9]+\.){3}[0-9]+' | uniq | tail -n 5 | tr '\n' '#'
echo -e "\n### $(date) ###"
sipt $mangle | grep -E '(0\.0\.0\.0)|(\.[01]/)'
sipt6 $mangle | grep '\-[sd] ::/128'
sipt $mangle | grep '\-A'|sort|uniq -dc
sipt6 $mangle | grep '\-A'|grep ':'|sort|uniq -dc
logread | grep 'daemon.err'
